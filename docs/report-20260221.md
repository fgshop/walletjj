# JOJUWallet 프로젝트 진행 보고서

**작성일:** 2026년 2월 21일
**프로젝트명:** JOJUWallet - TRON 기반 하이브리드 커스터디 월렛
**버전:** Phase 3 완료 / Phase 4 준비 중

---

## 1. 프로젝트 개요

JOJUWallet은 TRON(TRC-20) 블록체인 기반의 **하이브리드 커스터디 월렛** 플랫폼입니다.

### 기존 지갑과의 차별점

| 구분 | 기존 지갑 (MetaMask 등) | 기존 거래소 지갑 | **JOJUWallet (하이브리드)** |
|------|------------------------|-----------------|---------------------------|
| 키 관리 | 사용자가 직접 보관 | 거래소가 전체 관리 | **서버 측 HD 월렛 + AES-256-GCM 암호화** |
| 잔액 조회 | 온체인만 | 오프체인 DB만 | **온체인 + 오프체인 이중 관리** |
| 송금 방식 | 사용자 직접 서명 | 거래소 일괄 처리 | **Hot Wallet 통한 자동 처리 + 관리자 승인** |
| 입금 감지 | 사용자 확인 | 거래소 시스템 | **블록 모니터링 자동 감지 + DB 반영** |
| 자금 보안 | 분실 시 복구 불가 | 거래소 해킹 리스크 | **개별 지갑 → Hot Wallet 자동 스윕** |
| UX | 기술 지식 필요 | 심플하지만 제한적 | **일반 사용자도 쉽게 사용 + 관리자 통제** |

**핵심 아키텍처:**
- 각 사용자에게 개별 TRON 주소가 발급되어 **온체인 입금**을 직접 받을 수 있음
- 입금된 자산은 자동으로 **Hot Wallet로 스윕(sweep)** 되어 자금 안전성 확보
- 사용자 잔액은 **DB 기반으로 정확하게 관리** (온체인 조회 지연/비용 문제 해결)
- 출금 시 **24시간 대기 + 관리자 승인** 이중 보안 체계로 무단 인출 방지
- 온체인과 오프체인 잔액 불일치를 **자동 정산(Reconcile)** 기능으로 관리

---

## 2. 기술 스택

| 영역 | 기술 |
|------|------|
| **모노레포** | Turborepo + pnpm Workspace |
| **백엔드 API** | NestJS + TypeScript |
| **데이터베이스** | MySQL + Prisma ORM |
| **캐시/큐** | Redis + BullMQ (비동기 작업 처리) |
| **블록체인** | TRON (TronWeb) - TRX / TRC-20 |
| **사용자 웹** | Next.js 15 + Tailwind CSS v4 |
| **관리자 웹** | Next.js 15 + Tailwind CSS v4 |
| **배포** | Vercel (API + Web + Admin) |
| **보안** | AES-256-GCM 암호화, HD Wallet, JWT + Refresh Token |
| **공유 패키지** | @joju/types (타입/열거형), @joju/utils (포맷/검증/변환) |

---

## 3. 완료된 작업 내역

### Phase 1 - 핵심 인프라 구축

#### 인증 시스템 (Auth)
- 회원가입 (이메일 + 비밀번호)
- 이메일 인증 (6자리 코드, 10분 유효, Gmail SMTP)
- 로그인 / 로그아웃 (JWT Access + Refresh Token)
- 토큰 갱신 (Refresh Token Rotation)
- 미인증 사용자 → 자동 인증 페이지 리다이렉트
- 인증 코드 재전송 기능

#### 지갑 시스템 (Wallet)
- 회원가입 시 TRON 지갑 자동 생성
- HD Wallet 기반 개별 주소 파생 (BIP32/BIP39)
- AES-256-GCM 개인키 암호화 저장
- 지갑 잠금/해제 (관리자 통제)

#### 사용자 관리
- 프로필 조회/수정 (GET/PATCH /users/me)
- 글로벌 JWT 인증 가드 (모든 API 자동 보호)
- @Public() 데코레이터로 비인증 API 선택 개방

---

### Phase 2 - 거래 및 블록체인 연동

#### 거래 시스템 (Transaction)
- **내부 송금**: 회원 간 즉시 이체 (DB 기반, 수수료 없음)
- **외부 출금**: TRON 네트워크를 통한 외부 주소 송금
- 거래 내역 조회 (필터링, 페이지네이션)

#### 출금 승인 워크플로우 (Withdrawal)
- **24시간 대기 규칙**: 첫 외부 출금 시 24시간 홀드
- **관리자 승인/거부**: BullMQ 타이머 → PENDING_APPROVAL 상태 전환
- **자동 실행**: 승인 후 Hot Wallet에서 온체인 전송 자동 처리
- 실패 시 사유 기록 및 관리자 알림

#### 블록체인 모니터링 (BlockMonitor)
- 10초 간격 TRON 블록 폴링
- TRX 전송 + TRC-20 이벤트 자동 감지
- 당사 지갑 주소로의 입금 자동 DB 반영

#### 알림 시스템 (Notification)
- DB 기반 알림 생성/조회/읽음 처리
- 입금, 출금, 지갑 잠금 등 12가지 알림 유형
- 미읽음 카운트 API

---

### Phase 3 - Hot Wallet / 스윕 아키텍처

#### 하이브리드 잔액 관리
- **DB 기반 잔액 계산**: `입금합 + 내부수신합 - 내부송금합 - 완료출금합`
- **가용 잔액**: DB 잔액 - 대기 중 출금액
- 온체인 잔액과 오프체인 잔액의 독립적 관리

#### 자동 스윕 시스템
- 입금 감지 → BullMQ 스윕 작업 자동 생성
- 개별 지갑 → Hot Wallet로 TRX/TRC-20 자동 이동
- TRC-20 스윕 시 가스비(TRX) 자동 전송

#### 잔액 정산 (Reconcile)
- 모든 토큰(TRX + TRC-20) 대상 온체인/오프체인 비교
- 잉여분 자동 회수, 부족분 자동 보충
- 처리 결과 상세 보고 (일치/회수/보충/오류 건수)

---

### Phase 2B - 프론트엔드

#### 사용자 웹 (apps/web) - 7개 화면
| 화면 | 경로 | 기능 |
|------|------|------|
| 로그인 | /login | 이메일/비밀번호 로그인, 미인증 시 자동 리다이렉트 |
| 회원가입 | /register | 이름/이메일/비밀번호 등록 |
| 이메일 인증 | /verify | 6자리 코드 입력, 자동 코드 재전송 |
| 대시보드 | /dashboard | 잔액 표시, 빠른 메뉴 |
| 송금 | /send | 내부/외부 송금 |
| 출금 | /withdraw | 외부 주소 출금 요청 |
| 받기 | /receive | QR 코드 + 주소 복사 |
| 거래 내역 | /transactions | 전체 거래 목록 (필터/페이지네이션) |
| 알림 | /notifications | 알림 목록, 읽음 처리 |

#### 관리자 웹 (apps/admin) - 6개 화면
| 화면 | 경로 | 기능 |
|------|------|------|
| 대시보드 | /dashboard | 통계 요약 (사용자 수, 거래량, 잔액) |
| 사용자 관리 | /users | 사용자 목록, 정지/활성화, 상세 정보 |
| 지갑 관리 | /wallets | 온체인/오프체인 잔액, 잠금/해제, 스윕, 정산 |
| 출금 승인 | /withdrawals | 승인/거부, 상태 필터, 실패 사유 툴팁 |
| 거래 내역 | /transactions | 전체 거래 모니터링 |
| 감사 로그 | /audit-logs | 관리자 행위 기록 (한국어 설명) |

---

### 인프라 / 배포

- **Vercel 배포**: API 서버리스 함수로 배포 완료
- **Prisma + pnpm 호환**: Vercel 환경 Module Resolution 패치 적용
- **CORS 설정**: localhost + Vercel 도메인 허용
- **환경변수 관리**: Vercel + 로컬 .env 분리

---

## 4. 데이터베이스 구조 (14개 테이블)

```
User                  - 사용자 계정
Session               - 로그인 세션 (JWT Refresh Token)
EmailVerification     - 이메일 인증 코드
Wallet                - 사용자 개별 TRON 지갑
MasterWallet          - Hot Wallet (마스터 지갑)
Transaction           - 모든 거래 기록 (입금/송금/스윕)
WithdrawalRequest     - 출금 요청 + 승인 워크플로우
SupportedToken        - 지원 토큰 목록 (TRC-20)
PriceHistory          - 토큰 시세 기록
AdminUser             - 관리자 계정 (RBAC 역할 기반)
AuditLog              - 관리자 행위 감사 로그
Notification          - 사용자 알림
PushToken             - 푸시 알림 토큰
SystemConfig          - 시스템 설정 (블록 높이 등)
```

---

## 5. 보안 체계

| 항목 | 적용 내역 |
|------|----------|
| **개인키 보호** | AES-256-GCM 암호화 + 서버 환경변수 키 분리 |
| **인증** | JWT Access Token (15분) + Refresh Token Rotation (7일) |
| **출금 보안** | 24시간 대기 + 관리자 승인 이중 체크 |
| **관리자 RBAC** | SUPER_ADMIN > ADMIN > OPERATOR > VIEWER 4단계 |
| **감사 추적** | 모든 관리자 행위 IP/시간/상세 기록 |
| **지갑 잠금** | 관리자 원클릭 지갑 잠금 (출금 차단) |
| **자금 분산** | 개별 지갑 → Hot Wallet 자동 스윕 (해킹 피해 최소화) |

---

## 6. 향후 작업 계획

### Phase 4 - JOJU Token 발행 및 브랜딩

| 항목 | 상세 내용 | 우선순위 |
|------|----------|---------|
| **JOJU Token 발행** | TRC-20 토큰 컨트랙트 배포 (총 발행량 10,000,000,000 JOJU) | 높음 |
| **토큰 컨트랙트** | 토큰명: JOJU, 심볼: JOJU, Decimals: 18, TRON 메인넷 배포 | 높음 |
| **토큰 시스템 연동** | SupportedToken에 JOJU 등록, 입금/출금/스윕 지원 | 높음 |
| **기존 회원 잔액 세팅** | 기존 회원 데이터 기반 JOJU 잔액 DB 반영 (마이그레이션 스크립트) | 높음 |
| **브랜드 디자인** | 상어 로고 적용, 전체 UI 아이덴티티 업데이트 | 중간 |
| **로고 적용 범위** | 웹/관리자 헤더, 로그인 화면, 파비콘, QR 코드 로고 오버레이 | 중간 |

### Phase 5 - 고도화 (예정)

| 항목 | 상세 내용 |
|------|----------|
| **Flutter 모바일 앱** | iOS / Android 네이티브 앱 (생체 인증, QR 스캔) |
| **실시간 시세** | JOJU/USDT 시세 연동, 차트 표시 |
| **푸시 알림** | FCM/APNs 연동 실시간 알림 |
| **2FA 보안** | TOTP 기반 2단계 인증 (Google Authenticator) |
| **다중 토큰 지원** | USDT, USDC 등 추가 TRC-20 토큰 |
| **KYC 연동** | 본인 인증 시스템 연동 |

---

## 7. 접속 정보

| 서비스 | URL |
|--------|-----|
| **사용자 웹** | https://jojuwallet.vercel.app |
| **관리자 웹** | https://jojuwallet-admin.vercel.app |
| **API** | https://jojuwallet-api.vercel.app |
| **API 문서 (Swagger)** | http://localhost:4000/api/docs (로컬) |

---

## 8. 요약

JOJUWallet은 **온체인의 투명성**과 **오프체인의 편의성**을 결합한 하이브리드 아키텍처로, 기존 지갑 솔루션 대비 다음과 같은 강점을 갖추고 있습니다:

1. **일반 사용자도 쉽게 사용** - 복잡한 블록체인 지식 없이 송금/수신 가능
2. **실시간 입금 감지** - 블록 모니터링으로 온체인 입금 자동 반영
3. **자금 안전성** - 개별 지갑 → Hot Wallet 자동 스윕으로 분산 리스크 최소화
4. **관리자 통제력** - 출금 승인, 지갑 잠금, 감사 로그 등 운영 도구 완비
5. **확장 가능한 구조** - 모노레포 + 공유 패키지로 웹/모바일/관리자 일관된 개발

현재 Phase 3까지 완료되어 **핵심 지갑 기능이 모두 동작하는 상태**이며, 다음 단계로 **JOJU Token 10B 발행**, **상어 로고 브랜딩**, **기존 회원 잔액 마이그레이션**을 진행할 예정입니다.
